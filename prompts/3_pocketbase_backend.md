### **Ticket 3: Integrate PocketBase Backend**  
**Role:** Backend Developer (BE)  

---

#### **Description**  
Configure PocketBase as the backend database and authentication system. Ensure existing collections (`users`, `links`, `link_categories`) are properly structured, secure, and accessible via API endpoints. Add a `theme` field to the `users` collection to store theme preferences and validate CRUD operations.  

---

#### **Acceptance Criteria**  
1. PocketBase is fully configured with the provided collections and security rules.  
2. `users` collection includes a `theme` field for storing user preferences.  
3. All collections have validated API endpoints for CRUD operations, filtering, sorting, and pagination.  
4. Security rules enforce user-specific data access (e.g., users can only view/edit their own links).  
5. OAuth2 providers (GitHub, Discord) are preconfigured in PocketBase (no frontend code changes required).  
6. Environment variables for PocketBase are documented and deployed.  

---

### **Implementation Steps**  

#### **1. Update `users` Collection Schema**  
- **Add `theme` field** to the `users` collection via PocketBase Admin UI:  
  - **Type:** Text  
  - **Options:** Allowed values: `system`, `dark`, `light` (default: `system`).  
  - **Rules:** Editable by the user (`@request.auth.id != "" && user.id = @request.auth.id`).  

#### **2. Validate Existing Collections**  
Ensure the following collections match the schema and rules provided in the [project documentation](#project-overview):  
1. **`links`**  
   - Fields: `url`, `title`, `description`, `user_id`, `category_id`, etc.  
   - Indexes: Ensure full-text search is enabled for `title` and `description`.  
   - Rules:  
     ```yaml
     createRule: "@request.auth.id != ''"  
     updateRule: "@request.auth.id != '' && user_id = @request.auth.id"  
     deleteRule: "@request.auth.id != '' && user_id = @request.auth.id"  
     ```  

2. **`link_categories`**  
   - Fields: `name`, `user_id`.  
   - Rules:  
     ```yaml
     createRule: "@request.auth.id != ''"  
     updateRule: "@request.auth.id != '' && user_id = @request.auth.id"  
     ```  

3. **`users`**  
   - Add `theme` field (as described above).  
   - Ensure OAuth2 settings are enabled in PocketBase Admin UI (**Settings → Auth Providers**).  

#### **3. Configure PocketBase API Endpoints**  
- **CRUD Endpoints** (auto-generated by PocketBase):  
  - `GET /api/collections/links/records` (supports filtering, sorting, pagination).  
  - `POST /api/collections/links/records`.  
  - Similar endpoints for `users` and `link_categories`.  

- **Filtering Examples:**  
  ```bash
  # Filter links by category and user
  /api/collections/links/records?filter=(category_id='CATEGORY_ID' && user_id='USER_ID')  

  # Full-text search on title/description
  /api/collections/links/records?filter=(title ~ 'searchTerm' || description ~ 'searchTerm')  
  ```  

#### **4. Security and Access Rules**  
- **Data Isolation:**  
  - All collections use `@request.auth.id` to restrict access to the logged-in user’s data.  
- **Validation Hooks:**  
  - Add PocketBase JavaScript hooks to validate data formats (e.g., URL validation for `links.url`).  

#### **5. Environment Variables**  
- **PocketBase Configuration** (server-side):  
  ```env
  # PocketBase server .env (not exposed to frontend)
  PB_ADMIN_EMAIL=admin@example.com  
  PB_ADMIN_PASSWORD=securepassword  
  ```  
- **Frontend Configuration** (via `.env`):  
  ```env
  VITE_POCKETBASE_URL=https://doit-links.pockethost.io  
  ```  

#### **6. Testing**  
1. Verify CRUD operations for all collections using Postman or PocketBase API Explorer.  
2. Test OAuth2 login flows (GitHub/Discord) to ensure user data is isolated.  
3. Validate `theme` field updates in the `users` collection.  

---

### **Documentation**  
- **API Reference:** Document endpoints for frontend usage (e.g., [Postman Collection](https://www.postman.com/)).  
- **Deployment Guide:** Provide steps to deploy PocketBase on Netlify/VPS.  

---

### **Future Enhancements**  
1. Add real-time synchronization using PocketBase subscriptions.  
2. Implement backup/restore workflows for collections.  

--- 

This ticket ensures a secure, scalable backend with validated data access and seamless integration for frontend features. Let me know if adjustments are needed!
