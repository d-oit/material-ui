### **Ticket 9: Performance Optimization**  
**Role:** Frontend Developer (FE) & DevOps Engineer (DO)  

---

#### **Description**  
Optimize the application for speed, efficiency, and responsiveness. Implement lazy loading, code splitting, asset optimization, and deploy performance best practices to ensure fast load times, smooth interactions, and high Lighthouse scores.  

---

### **Acceptance Criteria**  
1. **Core Web Vitals:** Achieve Lighthouse scores ≥90 for Performance, Accessibility, and Best Practices.  
2. **Code Splitting:** Route-based and component-based code splitting reduces initial bundle size.  
3. **Lazy Loading:** Images, components, and non-critical resources load on demand.  
4. **Caching:** Static assets are cached efficiently via service workers and CDN.  
5. **Asset Optimization:** Images, fonts, and CSS/JS files are minified and compressed.  
6. **PocketBase Optimization:** Database queries are indexed and paginated for speed.  

---

### **Implementation Steps**  

#### **1. Frontend: Code Splitting & Lazy Loading**  
- **Route-Based Splitting with React.lazy:**  
  ```tsx  
  // src/routes.tsx  
  import { lazy, Suspense } from 'react';  
  import { CircularProgress } from '@mui/material';  

  const Home = lazy(() => import('./pages/Home'));  
  const Settings = lazy(() => import('./pages/Settings'));  

  const AppRoutes = () => (  
    <Suspense fallback={<CircularProgress />}>  
      <Routes>  
        <Route path="/" element={<Home />} />  
        <Route path="/settings" element={<Settings />} />  
      </Routes>  
    </Suspense>  
  );  
  ```  

- **Image Lazy Loading with Material UI:**  
  ```tsx  
  // src/components/LazyImage.tsx  
  import { useState } from 'react';  
  import { Skeleton, Box } from '@mui/material';  

  const LazyImage = ({ src, alt }: { src: string; alt: string }) => {  
    const [loaded, setLoaded] = useState(false);  
    return (  
      <>  
        {!loaded && <Skeleton variant="rectangular" width="100%" height={200} />}  
        <Box  
          component="img"  
          src={src}  
          alt={alt}  
          onLoad={() => setLoaded(true)}  
          sx={{ display: loaded ? 'block' : 'none' }}  
        />  
      </>  
    );  
  };  
  ```  

#### **2. Frontend: Bundle Optimization**  
- **Analyze Bundle with Vite Plugin:**  
  ```bash  
  npm install rollup-plugin-visualizer  
  ```  
  ```ts  
  // vite.config.ts  
  import { visualizer } from 'rollup-plugin-visualizer';  

  export default defineConfig({  
    plugins: [visualizer({ open: true })],  
  });  
  ```  
- **Optimize Material UI Imports:**  
  ```ts  
  // src/styles/optimizedImports.ts  
  export { default as Button } from '@mui/material/Button';  
  export { default as TextField } from '@mui/material/TextField';  
  ```  

#### **3. Frontend: PWA Caching Strategies**  
- **Update Vite PWA Plugin Config:**  
  ```ts  
  // vite.config.ts  
  VitePWA({  
    workbox: {  
      runtimeCaching: [  
        {  
          urlPattern: ({ url }) => url.pathname.startsWith('/assets'),  
          handler: 'CacheFirst',  
          options: { cacheName: 'assets-cache' },  
        },  
      ],  
    },  
  });  
  ```  

#### **4. Backend: PocketBase Query Optimization**  
- **Add Indexes to Collections:**  
  ```sql  
  -- For `links` collection  
  CREATE INDEX idx_user_links ON links (user_id, created);  
  ```  
- **Paginate Heavy Queries:**  
  ```ts  
  // Fetch links with pagination  
  const { data } = useQuery(['links', page], () =>  
    pb.collection('links').getList(page, 10, {  
      sort: '-created',  
      filter: `user_id = "${userId}"`,  
    })  
  );  
  ```  

#### **5. DevOps: Deployment & CDN Configuration**  
- **Netlify Headers for Caching:**  
  ```toml  
  # netlify.toml  
  [[headers]]  
    for = "/assets/*"  
    [headers.values]  
      Cache-Control = "public, max-age=31536000, immutable"  
  ```  
- **Enable Brotli Compression:**  
  ```toml  
  # netlify.toml  
  [build]  
    command = "npm run build"  
    publish = "dist"  

  [[plugins]]  
    package = "netlify-plugin-brotli"  
  ```  

#### **6. Asset Optimization**  
- **Convert Images to WebP:**  
  ```bash  
  # Use Sharp or ImageMagick to batch-convert images  
  npm install sharp  
  ```  
- **Minify CSS/JS:**  
  - Vite automatically handles this in production builds.  

---

### **Testing**  
1. **Lighthouse Audit:**  
   - Run `npm run build && npm run preview`, then test with Lighthouse.  
   - Verify scores ≥90 for Performance, Accessibility, SEO.  
2. **Bundle Analysis:**  
   - Check `stats.html` generated by `rollup-plugin-visualizer`.  
3. **Network Throttling:**  
   - Use Chrome DevTools to simulate 3G and test load times.  

---

### **Documentation**  
- **Performance Checklist:** Document steps for maintaining optimizations (e.g., image compression, dependency updates).  
- **Query Best Practices:** Guide for writing efficient PocketBase queries.  

---

### **Future Enhancements**  
1. **Server-Side Rendering (SSR):** Improve SEO and initial load times.  
2. **Edge Caching:** Use Netlify Edge Functions or Cloudflare Workers.  
3. **Prefetching:** Preload critical routes/data based on user behavior.  

---

This ticket ensures the application delivers a fast, smooth experience while adhering to modern performance standards. Let me know if adjustments are needed!
